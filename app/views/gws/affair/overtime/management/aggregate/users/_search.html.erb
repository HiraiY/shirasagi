<%
  threshold_hour = SS.config.gws.affair.dig("overtime", "aggregate", "threshold_hour")
%>

<% if @unlocked_time_cards.present? %>
  <div id="errorExplanation" class="errorExplanation">
  <h2><%= t("gws/affair.notice.time_card_unlocked.h2", year: @year, month: @month) %></h2>
    <p><%= t("gws/affair.notice.time_card_unlocked.p") %></p>
    <ul>
      <% @unlocked_time_cards.each do |title| %>
        <li><%= title %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<div class="attendance-box">
  <div class="attendance-box-main">
    <%
      group_options = @groups.map { |g| [g.name, g.id] }
      year_options = ((@current.year - 5)..(@current.year)).map { |y| ["#{y}#{t("datetime.prompts.year")}", y] }.reverse
      month_options = (1..12).map { |m| ["#{m}#{t("datetime.prompts.month")}", m] }

      capital_options = Gws::Affair::Capital.site(@cur_site).pluck(:no, :name, :id)
      capital_options.map! { |no, name, id| [ [no.presence, name.presence].compact.join(" "), id ] }
    %>
    <%= form_for :s, url: "", html: { method: :get } do |f| %>
      <%= f.select :group_id, group_options %>
      <%= f.select :capital_id, capital_options, include_blank: "原資区分" %>
      <%= f.select :year, year_options %>
      <%= f.select :month, month_options %>

      <input type="submit" value="<%= t('ss.buttons.search') %>" class="btn" />
      <%= link_to t("ss.buttons.reset"), gws_affair_overtime_management_aggregate_users_path, class: "btn" %>
      <%= link_to t("ss.links.download"), gws_affair_overtime_management_aggregate_download_users_path(s: @s.to_h), class: "btn", style: "float: right;" %>
    <% end %>
  </div>
</div>

<div class="gws-schedule-tabs">
  <%= link_to gws_affair_overtime_management_aggregate_users_path(threshold: "under", s: params.permit(s: [:group_id, :capital_id, :year, :month]).dig(:s)), class: params[:threshold] == "under" ? "current" : nil do %>
    <span class="tab-name">通常分</span>
  <% end %>
  <%= link_to gws_affair_overtime_management_aggregate_users_path(threshold: "over", s: params.permit(s: [:group_id, :capital_id, :year, :month]).dig(:s)), class: params[:threshold] == "over" ? "current" : nil do %>
    <span class="tab-name">割合引上対象分（<%= "#{threshold_hour}時間超過" %>）</span>
  <% end %>
  <%= link_to gws_affair_overtime_management_aggregate_users_path(threshold: "total", s: params.permit(s: [:group_id, :capital_id, :year, :month]).dig(:s)), class: params[:threshold] == "total" ? "current" : nil do %>
    <span class="tab-name">時間外合計</span>
  <% end %>
</div>
